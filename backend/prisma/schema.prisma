generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(uuid())
  nombre         String
  email          String          @unique
  password       String
  role           String          @default("CLIENTE")
  barberiaId     String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  barberiaAdmin  Barberia?       @relation("BarberiaAdmin")
  BarberoProfile BarberoProfile?
  barberia       Barberia?       @relation("BarberiaUsers", fields: [barberiaId], references: [id])
}

model Barberia {
  id            String        @id @default(uuid())
  nombre        String
  adminId       String?       @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  admin         User?         @relation("BarberiaAdmin", fields: [adminId], references: [id])
  clientes      Cliente[]
  metodosPago   MetodoPago[]
  productos     Producto[]
  servicios     Servicio[]
  transacciones Transaccion[]
  turnos        Turno[]
  users         User[]        @relation("BarberiaUsers")
}

model BarberoProfile {
  id           String           @id @default(uuid())
  userId       String           @unique
  telefono     String?
  especialidad String?
  activo       Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  ausencias    Ausencia[]
  user         User             @relation(fields: [userId], references: [id])
  horarios     HorarioLaboral[]
  turnos       Turno[]
  servicios    Servicio[]       @relation("BarberoProfileToServicio")
}

model Servicio {
  id              String           @id @default(uuid())
  barberiaId      String
  nombre          String
  descripcion     String?
  precio          Float
  duracionMinutos Int
  activo          Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  barberia        Barberia         @relation(fields: [barberiaId], references: [id])
  turnos          Turno[]
  barberos        BarberoProfile[] @relation("BarberoProfileToServicio")
}

model Cliente {
  id                String        @id @default(uuid())
  barberiaId        String
  nombre            String
  email             String?
  telefono          String?
  notasPreferencias String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  barberia          Barberia      @relation(fields: [barberiaId], references: [id])
  transacciones     Transaccion[]
  turnos            Turno[]
}

model Turno {
  id              String         @id @default(uuid())
  barberiaId      String
  barberoId       String
  clienteId       String
  servicioId      String
  fechaHoraInicio DateTime
  fechaHoraFin    DateTime
  estado          String         @default("PENDIENTE")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  transacciones   Transaccion[]
  servicio        Servicio       @relation(fields: [servicioId], references: [id])
  cliente         Cliente        @relation(fields: [clienteId], references: [id])
  barbero         BarberoProfile @relation(fields: [barberoId], references: [id])
  barberia        Barberia       @relation(fields: [barberiaId], references: [id])
}

model MetodoPago {
  id            String        @id @default(uuid())
  barberiaId    String
  nombre        String
  activo        Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  barberia      Barberia      @relation(fields: [barberiaId], references: [id])
  transacciones Transaccion[]
}

model Transaccion {
  id           String     @id @default(uuid())
  barberiaId   String
  turnoId      String?
  clienteId    String?
  monto        Float
  tipo         String
  metodoPagoId String
  descripcion  String?
  fecha        DateTime   @default(now())
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  metodoPago   MetodoPago @relation(fields: [metodoPagoId], references: [id])
  cliente      Cliente?   @relation(fields: [clienteId], references: [id])
  turno        Turno?     @relation(fields: [turnoId], references: [id])
  barberia     Barberia   @relation(fields: [barberiaId], references: [id])
}

model HorarioLaboral {
  id         String         @id @default(uuid())
  barberoId  String
  diaSemana  Int
  horaInicio String
  horaFin    String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  descansos  Descanso[]
  barbero    BarberoProfile @relation(fields: [barberoId], references: [id])
}

model Descanso {
  id         String         @id @default(uuid())
  horarioId  String
  horaInicio String
  horaFin    String
  horario    HorarioLaboral @relation(fields: [horarioId], references: [id], onDelete: Cascade)
}

model Ausencia {
  id          String         @id @default(uuid())
  barberoId   String
  fechaInicio DateTime
  fechaFin    DateTime
  motivo      String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  barbero     BarberoProfile @relation(fields: [barberoId], references: [id])
}

model Producto {
  id          String   @id @default(uuid())
  barberiaId  String
  nombre      String
  descripcion String?
  precioVenta Float
  stockActual Int      @default(0)
  stockMinimo Int      @default(0)
  imagen      String?
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  barberia    Barberia @relation(fields: [barberiaId], references: [id])
}
